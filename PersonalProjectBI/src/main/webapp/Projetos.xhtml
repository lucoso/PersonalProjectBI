<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/Layout.xhtml">

	<ui:define name="content">

		<f:metadata>
			<f:viewAction action="#{projetoBean.BuscarUsuario}"></f:viewAction>
			<f:viewAction action="#{projetoBean.Inicializar}"></f:viewAction>
		</f:metadata>

		<h1 class="aw-page-title">Projetos</h1>

		<h:form id="projeto-frm">

			<p:messages autoUpdate="true" />

			<p:toolbar id="toolbar">
				<p:toolbarGroup>

					<p:menuButton value="Cadastrar Projeto">
						<p:menuitem value="Pessoal" process="@this" icon="fa fa-fw fa-plus" action="#{projetoBean.ProjetoPessoalEmEdicao}"
										update="projeto-dialog" oncomplete="PF('projeto-Dialog').show()"  />
							
							<p:separator />
							
						<p:menuitem value="Processo Seletivo" process="@this" icon="fa fa-fw fa-plus" action="#{projetoBean.ProjetoSeletivoEmEdicao}"
										update="projeto-dialog" oncomplete="PF('projeto-Dialog').show()"  />
						
					</p:menuButton>
					
					<span class="ui-separator">
						<span class="ui-icon ui-icon-grip-dotted-vertical"/>
					</span>

					<p:commandButton value="Atualizar Projeto" process="@this" icon="fa fa-fw fa-edit" action="#{projetoBean.AtualizarProjetoEmEdicao}"
						update="projeto-dialog" disabled="#{projetoBean.projetoSelecionado == null}" oncomplete="PF('projeto-Dialog').show()" />

				</p:toolbarGroup>
			</p:toolbar>

			<!-- datatable projetos -->

			<p:dataTable id="table-projetos" value="#{projetoBean.projetos}"
				var="projeto" reflow="true"
				emptyMessage="Nenhum Projeto Cadastrado ate o Momento."
				style="margin-top: 10px" rows="10" paginator="true"
				paginatorPosition="bottom" lazy="true" resizableColumns="true"
				selection="#{projetoBean.projetoSelecionado}" selectionMode="single"
				rowKey="#{projeto.id}">

				<p:ajax event="rowSelect" update=":projeto-frm:toolbar" />
				<p:ajax event="rowUnselect" update=":projeto-frm:toolbar" />

				<f:facet name="header">
					Projetos
				</f:facet>

				<p:column headerText="Tipo de Projeto" style="text-align:center">
					<h:outputText value="Projeto Pessoal"
						rendered="#{projeto.emProducao != null}" />
					<h:outputText value="Projeto Processo Seletivo"
						rendered="#{projeto.emProducao == null}" />
				</p:column>

				<p:column headerText="Nome" style="text-align:center"
					filterBy="#{projeto.nome}">
					<h:outputText value="#{projeto.nome}" />
				</p:column>

				<p:column headerText="Data de Início" style="text-align:center">
					<h:outputText value="#{projeto.dataInicio}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="Finalizado" style="text-align:center"
					filterBy="#{projeto.finalizado}">
					<h:outputText value="Sim" rendered="#{projeto.finalizado == true}" />
					<h:outputText value="Não" rendered="#{projeto.finalizado == false}" />
				</p:column>

				<p:column headerText="Data Finalizado" style="text-align:center">
					<h:outputText value="#{projeto.dataFinalizado}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="Em Produção" style="text-align:center">
					<h:outputText value="Sim" rendered="#{projeto.emProducao == true}" />
					<h:outputText value="Não" rendered="#{projeto.emProducao == false}" />
				</p:column>

				<p:column headerText="Aprovado" style="text-align:center">
					<h:outputText value="Sim" rendered="#{projeto.aprovado == true}" />
					<h:outputText value="Não" rendered="#{projeto.aprovado == false}" />
				</p:column>

				<p:column headerText="Empresa" style="text-align:center">
					<h:outputText value="#{projeto.empresaResponsavel.nome}" />
				</p:column>

				<p:column headerText="Excluir Projeto" style="text-align:center">
					<p:commandButton icon="fa fa-fw fa-trash" title="Excluir Projeto"
						action="#{projetoBean.ExcluirProjeto}" process="@this">
						<f:setPropertyActionListener target="#{projetoBean.projetoParaExcluir}" value="#{projeto}" />
						<p:confirm header="Confirmação" message="Tem Certeza que Deseja Excluir? OBS: A Empresa desse projeto também será excluída!" icon="ui-icon-alert" />
					</p:commandButton>
				</p:column>

			</p:dataTable>

			<!-- Dialogs da Pagina -->


			<!-- Dialog cadastrar/atualizar projeto -->

			<p:dialog widgetVar="projeto-Dialog" id="projeto-dialog"
				header="Dados do Projeto" resizable="false" style="min-width: 300px"
				responsive="true" modal="true">

				<h:panelGroup id="projetoPanel" layout="block" styleClass="ui-fluid">

					<p:messages autoUpdate="true" id="msg-ag" />

					<p:panelGrid columns="2" layout="grid"
						styleClass="panelgrid-noborder" id="painel-dialog"
						columnClasses="ui-grid-col-4, ui-grid-col-8">

						<p:defaultCommand target="botao-salvarProjeto"
							scope="projeto-dialog" />
						<p:outputLabel />

						<p:outputLabel for="tipoprojeto" value="Tipo de Projeto: " />
						<p:selectOneRadio id="tipoprojeto"
							value="#{projetoBean.tipoProjeto}" required="true"
							requiredMessage="Escolha o tipo de Projeto">
							<f:selectItem itemLabel="Pessoal" itemValue="Pessoal" />
							<f:selectItem itemLabel="Processo Seletivo" itemValue="Seletivo" />
							<p:ajax update="aprovado empresa emproducao" />
						</p:selectOneRadio>

						<p:outputLabel for="nome" value="Nome: " />
						<p:inputText id="nome" value="#{projetoBean.projeto.nome}" />

						<p:outputLabel for="datainicio" value="Data Início: " />
						<p:calendar id="datainicio"
							value="#{projetoBean.projeto.dataInicio}" pattern="dd/MM/yyyy"
							locale="pt"/>

							<p:outputLabel for="finalizado" value="Finalizado? " />
							<p:selectOneMenu id="finalizado"
								value="#{projetoBean.projeto.finalizado}">
								<f:selectItem itemLabel="Escolha" itemValue=""
									noSelectionOption="true" />
								<f:selectItem itemLabel="SIM" itemValue="true" />
								<f:selectItem itemLabel="NÃO" itemValue="false" />
							</p:selectOneMenu>

							<p:outputLabel for="datafim" value="Data Finalizado: " />
							<p:calendar id="datafim"
								value="#{projetoBean.projeto.dataFinalizado}"
								pattern="dd/MM/yyyy" locale="pt"
								disabled="#{projetoBean.projeto.finalizado != true}"/>

								<p:outputLabel for="aprovado" value="Aprovado? " />
								<p:selectOneMenu id="aprovado"
									value="#{projetoBean.aprovado}"
									disabled="#{projetoBean.tipoProjeto != 'Seletivo'}">
									<f:selectItem itemLabel="Escolha" itemValue=""
										noSelectionOption="true" />
									<f:selectItem itemLabel="SIM" itemValue="true" />
									<f:selectItem itemLabel="NÃO" itemValue="false" />
								</p:selectOneMenu>

								<p:outputLabel for="empresa" value="Empresa: " />
								<p:autoComplete id="empresa"
									value="#{projetoBean.empresaResponsavel}" var="emp"
									itemLabel="#{emp.nome}" itemValue="#{emp}"
									forceSelection="true" converter="empresaConverter"
									required="true" requiredMessage="Escolha a Empresa"
									title="Caso o Nome da Empresa não Apareça, é Necessário Cadastrar a Empresa Primeiro!"
									completeMethod="#{projetoBean.CompletarNomeEmpresa}"
									disabled="#{projetoBean.tipoProjeto != 'Seletivo'}" />

								<p:outputLabel />
								<p:tooltip id="toolTipEmpresa" for="empresa" showEvent="focus"
									hideEvent="blur" showEffect="clip" hideEffect="explode" />

								<p:outputLabel for="emproducao" value="Em Produção? " />
								<p:selectOneMenu id="emproducao"
									value="#{projetoBean.emProducao}"
									disabled="#{projetoBean.tipoProjeto != 'Pessoal'}">
									<f:selectItem itemLabel="Escolha" itemValue=""
										noSelectionOption="true" />
									<f:selectItem itemLabel="SIM" itemValue="true" />
									<f:selectItem itemLabel="NÃO" itemValue="false" />
								</p:selectOneMenu>

								<p:outputLabel />
								<p:commandButton id="botao-salvarProjeto" value="Salvar"
									actionListener="#{projetoBean.Salvar}" process="projeto-dialog"
									update="projetoPanel table-projetos"
									oncomplete="if (!args.validationFailed) PF('projeto-Dialog').hide()" />
					</p:panelGrid>

				</h:panelGroup>

			</p:dialog>

			<p:confirmDialog showEffect="fade" hideEffect="fade"
				id="confirm-dialog" global="true">
				<p:commandButton value="Sim" type="button"
					styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
				<p:commandButton value="Não" type="button"
					styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</p:confirmDialog>

		</h:form>
	</ui:define>

</ui:composition>